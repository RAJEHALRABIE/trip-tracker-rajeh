rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    function isSignedIn() { return request.auth != null; }

    function isOwnerTrip(tripId) {
      return isSignedIn() &&
        get(/databases/(default)/documents/trips/$(tripId)).data.ownerId == request.auth.uid;
    }

    // مرفقات الرحلات (إن وُجدت) على المسار: trips/{tripId}/...
    match /trips/{tripId}/{file=**} {
      allow read: if isOwnerTrip(tripId);
      allow write: if isOwnerTrip(tripId) && request.resource.size < 10 * 1024 * 1024; // < 10MB
    }
// trigger deploy

    // منع أي مسارات أخرى
    match /{allPaths=**} { allow read, write: if false; }
  }
}
